<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mystic Tools — Single File Frontend</title>
  <style>
    :root { --bg:#0f1223; --panel:#141739; --border:#2a2e4a; --text:#fff; --muted:#b9bed6; --accent:#7c5cff; }
    * { box-sizing:border-box; }
    body { margin:0; background:var(--bg); color:var(--text); font-family:system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .wrap { max-width:900px; margin:0 auto; padding:24px; }
    .panel { background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:18px; margin-bottom:16px; }
    h1,h2 { margin:0 0 12px; }
    label { display:block; margin:10px 0 6px; color:var(--muted); }
    input, textarea { width:100%; padding:12px; border:1px solid var(--border); border-radius:10px; background:#0c0f26; color:#fff; }
    button { padding:10px 14px; border:1px solid var(--border); border-radius:10px; background:#1b1f3a; color:#fff; cursor:pointer; }
    button:hover { background:#283056; }
    pre { background:#0c0f26; border:1px solid var(--border); border-radius:12px; padding:12px; overflow:auto; }
    .note { color:var(--muted); }
    .success { border-color:#3aa76d; }
    .error { border-color:#a33; color:#f88; }
    .tabs { display:flex; gap:8px; margin-bottom:12px; }
    .hidden { display:none; }
    #blackout { position:fixed; inset:0; background:#000; z-index:999999; display:none; }
    body.blocked * { display:none !important; }
    body.blocked #blackout { display:block !important; }
  </style>
</head>
<body>
  <div id="blackout"></div>
  <div class="wrap">
    <h1>Mystic Tools</h1>
    <p class="note">This site calls your own API (hosted on Vercel) which forwards permitted requests to upstream APIs. Opening DevTools will black out the page and block further requests.</p>

    <div class="tabs">
      <button id="tab-create" data-tab="create">Create Directory</button>
      <button id="tab-verify" data-tab="verify">Verification</button>
    </div>

    <section id="view-create" class="panel">
      <h2>Create Directory</h2>
      <p class="note">POST → /api/app/create-directory → forwards to dayonerblx.com/api/createDirectory.php</p>
      <form id="form-create">
        <label>Directory Name</label>
        <input id="dir" placeholder="letters, numbers, underscore, hyphen" required />
        <label>Directory Webhook (Discord)</label>
        <input id="wh" placeholder="https://discord.com/api/webhooks/..." required />
        <label>Custom Discord Link (Optional)</label>
        <input id="link" placeholder="https://discord.gg/... or leave blank" />
        <div style="margin-top:10px; display:flex; gap:10px">
          <button type="submit">Create</button>
          <button type="button" id="resetCreate">Reset</button>
        </div>
      </form>
      <div id="out-create" style="margin-top:12px"></div>
    </section>

    <section id="view-verify" class="panel hidden">
      <h2>Verification</h2>
      <p class="note">POST → /api/app/verification → forwards to dayonerblx.com/api/verification.php. Paste the exact JSON body you captured for that endpoint.</p>
      <form id="form-verify">
        <label>JSON Body</label>
        <textarea id="verifyBody" rows="6" placeholder='{"key":"value"}'></textarea>
        <div style="margin-top:10px; display:flex; gap:10px">
          <button type="submit">Send</button>
          <button type="button" id="resetVerify">Reset</button>
        </div>
      </form>
      <div id="out-verify" style="margin-top:12px"></div>
    </section>
  </div>

  <script>
    // ----- DevTools detection & request blocking (deterrent only) -----
    (function(){
      const threshold = 150;
      let blocked = false;
      function blackout(){
        if (blocked) return;
        blocked = true;
        document.body.classList.add('blocked');
        try {
          const origFetch = window.fetch.bind(window);
          window.fetch = async () => { throw new Error('Blocked by anti-devtools'); };
          const OrigXHR = window.XMLHttpRequest;
          function BlockedXHR(){ throw new Error('Blocked by anti-devtools'); }
          BlockedXHR.prototype = OrigXHR?.prototype || {};
          window.XMLHttpRequest = BlockedXHR;
        } catch {}
        try {
          const id = setInterval(()=>{}, 999999);
          for (let i = 0; i <= id; i++) clearInterval(i);
          const tid = setTimeout(()=>{}, 999999);
          for (let i = 0; i <= tid; i++) clearTimeout(i);
        } catch {}
      }
      function devtoolsOpenHeuristic(){
        const w = window.outerWidth - window.innerWidth > threshold;
        const h = window.outerHeight - window.innerHeight > threshold;
        return w || h;
      }
      setInterval(()=>{ if (devtoolsOpenHeuristic()) blackout(); }, 500);
      window.addEventListener('resize', ()=>{ if (devtoolsOpenHeuristic()) blackout(); });
      window.addEventListener('keydown', (e)=>{
        const k = e.key;
        if (k === 'F12' || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(k))) {
          e.preventDefault(); blackout();
        }
      });
      window.addEventListener('contextmenu', (e)=>{ e.preventDefault(); blackout(); });
      try {
        const origClear = console.clear?.bind(console);
        console.clear = function(){ blackout(); return origClear ? origClear() : undefined; };
      } catch {}
    })();

    // ----- Tabs -----
    function show(tab) {
      document.getElementById('view-create').classList.toggle('hidden', tab !== 'create');
      document.getElementById('view-verify').classList.toggle('hidden', tab !== 'verify');
    }
    document.getElementById('tab-create').onclick = () => show('create');
    document.getElementById('tab-verify').onclick = () => show('verify');

    // ----- Helpers -----
    function print(outId, ok, data) {
      const el = document.getElementById(outId); el.innerHTML = '';
      const pre = document.createElement('pre'); pre.className = ok ? 'success' : 'error';
      try { pre.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2); }
      catch { pre.textContent = String(data); }
      el.appendChild(pre);
    }
    const API_BASE = '/api/app';

    // ----- Create Directory -----
    document.getElementById('form-create').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const body = {
        directoryName: document.getElementById('dir').value.trim(),
        webhook: document.getElementById('wh').value.trim(),
        discordLink: (document.getElementById('link').value.trim() || null)
      };
      const res = await fetch(API_BASE + '/create-directory', {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)
      });
      const t = await res.text(); let data; try { data = JSON.parse(t); } catch { data = t; }
      print('out-create', res.ok, data);
    });
    document.getElementById('resetCreate').onclick = ()=>{
      document.getElementById('dir').value = '';
      document.getElementById('wh').value = '';
      document.getElementById('link').value = '';
      document.getElementById('out-create').innerHTML = '';
    };

    // ----- Verification -----
    document.getElementById('form-verify').addEventListener('submit', async (e)=>{
      e.preventDefault();
      let raw = document.getElementById('verifyBody').value.trim();
      let body; try { body = raw ? JSON.parse(raw) : {}; } catch { body = {}; }
      const res = await fetch(API_BASE + '/verification', {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)
      });
      const t = await res.text(); let data; try { data = JSON.parse(t); } catch { data = t; }
      print('out-verify', res.ok, data);
    });
    document.getElementById('resetVerify').onclick = ()=>{
      document.getElementById('verifyBody').value = '';
      document.getElementById('out-verify').innerHTML = '';
    };
  </script>
</body>
</html>
